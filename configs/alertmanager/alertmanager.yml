# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alertmanager
global:
  # –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  resolve_timeout: 5m
  # SMTP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
  # smtp_smarthost: 'smtp.gmail.com:587'
  # smtp_from: 'alertmanager@example.com'
  # smtp_auth_username: 'alertmanager@example.com'
  # smtp_auth_password: 'password'
  # smtp_require_tls: true

# –®–∞–±–ª–æ–Ω—ã –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
templates:
  - '/etc/alertmanager/*.tmpl'

# –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∞–ª–µ—Ä—Ç–æ–≤
route:
  # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤ –ø–æ —ç—Ç–∏–º –º–µ—Ç–∫–∞–º
  group_by: ['alertname', 'cluster', 'service']

  # –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –ø–µ—Ä–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  group_wait: 10s

  # –í—Ä–µ–º—è –º–µ–∂–¥—É –≥—Ä—É–ø–ø–∞–º–∏ –∞–ª–µ—Ä—Ç–æ–≤
  group_interval: 10s

  # –í—Ä–µ–º—è –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
  repeat_interval: 12h

  # –ü–æ–ª—É—á–∞—Ç–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  receiver: 'default'

  # –ü–æ–¥–º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∞–ª–µ—Ä—Ç–æ–≤
  routes:
    # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 5s
      repeat_interval: 4h

    # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
    - match:
        severity: warning
      receiver: 'warning-alerts'
      group_wait: 30s
      repeat_interval: 12h

    # –ê–ª–µ—Ä—Ç—ã –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    - match:
        category: security
      receiver: 'security-alerts'
      group_wait: 5s
      repeat_interval: 2h

# –ü–æ–¥–∞–≤–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –∞–ª–µ—Ä—Ç–æ–≤
inhibit_rules:
  # –ü–æ–¥–∞–≤–ª—è–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è, –µ—Å–ª–∏ –µ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∞–ª–µ—Ä—Ç
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'instance']

  # –ü–æ–¥–∞–≤–ª—è–µ–º –∞–ª–µ—Ä—Ç—ã –æ –≤—ã—Å–æ–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–µ, –µ—Å–ª–∏ —Å–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
  - source_match:
      alertname: 'ServiceDown'
    target_match_re:
      alertname: '(HighCPUUsage|HighMemoryUsage|HighDiskIOUsage)'
    equal: ['instance']

# –ü–æ–ª—É—á–∞—Ç–µ–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
receivers:
  # –ü–æ–ª—É—á–∞—Ç–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (webhook –∏–ª–∏ –∫–æ–Ω—Å–æ–ª—å)
  - name: 'default'
    webhook_configs:
      - url: 'http://localhost:5001/alert'
        send_resolved: true
        http_config:
          follow_redirects: true
    # –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –¥–ª—è email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    # email_configs:
    #   - to: 'team@example.com'
    #     from: 'alertmanager@example.com'
    #     subject: '[Monitoring] {{ .GroupLabels.alertname }}'
    #     html: '{{ template "email.default.html" . }}'

  # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã
  - name: 'critical-alerts'
    webhook_configs:
      - url: 'http://localhost:5001/alert/critical'
        send_resolved: true
    # email_configs:
    #   - to: 'oncall@example.com'
    #     from: 'alertmanager@example.com'
    #     subject: 'üö® [CRITICAL] {{ .GroupLabels.alertname }}'
    #     html: '{{ template "email.critical.html" . }}'
    # –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å Slack, PagerDuty, –∏ —Ç.–¥.
    # slack_configs:
    #   - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
    #     channel: '#critical-alerts'
    #     title: 'üö® {{ .GroupLabels.alertname }}'
    #     text: '{{ range .Alerts }}{{ .Annotations.description }}{{ end }}'

  # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
  - name: 'warning-alerts'
    webhook_configs:
      - url: 'http://localhost:5001/alert/warning'
        send_resolved: true
    # email_configs:
    #   - to: 'team@example.com'
    #     from: 'alertmanager@example.com'
    #     subject: '‚ö†Ô∏è [WARNING] {{ .GroupLabels.alertname }}'

  # –ê–ª–µ—Ä—Ç—ã –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
  - name: 'security-alerts'
    webhook_configs:
      - url: 'http://localhost:5001/alert/security'
        send_resolved: true
    # email_configs:
    #   - to: 'security@example.com'
    #     from: 'alertmanager@example.com'
    #     subject: 'üîí [SECURITY] {{ .GroupLabels.alertname }}'
